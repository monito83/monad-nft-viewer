<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Proyectos NFT Monad</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f0f0f0; color: #333; margin:0; padding:0; }
    header { background: #4c51bf; color: white; text-align:center; padding:1.5rem; }
    header h1 { margin:0; font-size:1.8rem; }
    .filters { display:flex; flex-wrap:wrap; gap:1rem; justify-content:center; padding:1rem; }
    .filters input, .filters select { padding:.5rem; font-size:1rem; border-radius:6px; border:1px solid #ccc; }

    main { max-width:1200px; margin:auto; padding:1rem; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(300px,1fr)); gap:1.5rem; }
    .card { background:white; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1); padding:1rem; display:flex; flex-direction:column; align-items:center; gap:.5rem; border-left:6px solid transparent; transition:transform .2s ease, box-shadow .2s ease; }
    .card:hover { transform:translateY(-4px); box-shadow:0 8px 20px rgba(0,0,0,0.12); cursor:pointer; }

    .card.tier-1-badge { background:#e6fffa; }
    .card.tier-2-badge { background:#f0fff4; }
    .card.tier-3-badge { background:#fffbea; }
    .card.tier-4-badge { background:#fff5f5; }
    .card.tier-5-badge { background:#ffe6e6; }

    .logo { width:60px; height:60px; border-radius:50%; object-fit:cover; }

    .tag, .tier-badge {
      display:inline-block; padding:.4rem .8rem; border-radius:6px; color:white; font-size:1rem; margin:.2rem; font-weight:bold;
    }
    .Abierto { background:#38a169; }
    .Cerrado { background:#e53e3e; }
    .Pendiente, .Desconocido, .Otro { background:#718096; }
    .tier-badge { background:#805ad5; }
    .tier-1-badge { background:gold; }
    .tier-2-badge { background:silver; }
    .tier-3-badge, .tier-4-badge, .tier-5-badge { background:#cd7f32; }

    .copy-btn, .buy-button {
      background:#4299e1; color:white; border:none; border-radius:6px; padding:.4rem .8rem; font-size:.9rem; font-weight:bold; cursor:pointer; text-decoration:none;
    }

    .modal {
      position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center;
    }
    .modal-content {
      background:white; padding:2rem; border-radius:12px; max-width:600px; max-height:85vh; overflow-y:auto; position:relative;
    }
    .modal-close { position:absolute; top:10px; right:20px; font-size:1.5rem; cursor:pointer; color:#333; }
    .info-block { margin-top:1rem; font-size:.95rem; line-height:1.5; white-space:pre-line; }
    .info-block strong { display:block; margin-bottom:.3rem; }
    .section { margin-bottom:1.2rem; }
    hr { border:none; border-top:1px solid #e2e8f0; margin:1rem 0; }
    footer { text-align:center; padding:1rem; font-size:.85rem; color:#666; }
  </style>
</head>
<body>
  <header>
    <h1>Proyectos NFT en Monad</h1>
    <p>Actualizado: <span id="fecha"></span></p>
  </header>

  <div class="filters">
    <input type="text" id="projectFilter" placeholder="Buscar proyecto...">
    <select id="tierFilter"><option value="">Todos los Tiers</option></select>
    <select id="estadoFilter"><option value="">Todos los Estados</option></select>
  </div>

  <main><div class="grid" id="cardGrid"></div></main>

  <div class="modal" id="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="modal.style.display='none'">&times;</span>
      <div id="modalDetails"></div>
    </div>
  </div>

  <footer>üîß Generado desde Google Sheets</footer>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    const SHEET_CSV = 'https://docs.google.com/spreadsheets/d/1lG1Xzzzs4jNKII6deHT_PtY6ltGPp2RAlr7_ak-wRZ4/export?format=csv';
    const cardGrid = document.getElementById('cardGrid');
    const fechaSpan = document.getElementById('fecha');
    const tierFilter = document.getElementById('tierFilter');
    const estadoFilter = document.getElementById('estadoFilter');
    const projectFilter = document.getElementById('projectFilter');
    const modal = document.getElementById('modal');
    const modalDetails = document.getElementById('modalDetails');
    let allData = [];

    function getTierBadge(t) {
      const tier = t?.toString();
      return tier === '1' ? 'tier-1-badge'
           : tier === '2' ? 'tier-2-badge'
           : tier === '3' ? 'tier-3-badge'
           : tier === '4' ? 'tier-4-badge'
           : tier === '5' ? 'tier-5-badge' : '';
    }

    function getEstadoClass(est) {
      return /abierto/i.test(est) ? 'Abierto' :
             /cerrado/i.test(est) ? 'Cerrado' :
             /pendiente/i.test(est) ? 'Pendiente' : 'Otro';
    }

    function showModal(idx) {
      const row = allData[idx];
      const estado = row['Estado Testnet'] || 'Desconocido';
      const floorD = row['Floor Price Pase Directo (MON)'] || '‚Äî';
      const floorA = row['Floor Price NFT Acumulativo (MON)'] || '‚Äî';

      modal.style.display = 'flex';
      modalDetails.innerHTML = `
        <div class="section" style="text-align:center;">
          ${row['Logo'] ? `<img src="${row['Logo']}" class="logo" style="width:80px;height:80px;">` : ''}
          <h2 style="margin: .5rem 0;">${row['Proyecto']}</h2>
          <div class="tag ${getEstadoClass(estado)}">${estado}</div>
          <div style="margin-top: .5rem;">
            <span class="tier-badge ${getTierBadge(row['Tier'])}">üèÖ Tier ${row['Tier']}</span>
          </div>
        </div>
        <hr>
        <div class="section info-block"><strong>üí∞ Floor Directo:</strong> ${floorD} MON</div>
        <div class="section info-block"><strong>üí∞ Floor Acumulativo:</strong> ${floorA} MON</div>
        <div class="section info-block"><strong>üß† Roles WL:</strong><br>${row['Roles WL'] || '‚Äî'}</div>
        <div class="section info-block"><strong>üì¶ Pase WL Directo:</strong><br>${row['Pase WL Directo'] || '‚Äî'}</div>
        <div class="section info-block"><strong>üìÑ Beneficio WL Directo:</strong><br>${row['Beneficio WL Directo'] || '‚Äî'}</div>
        <div class="section info-block"><strong>üì¶ NFT Acumulativo:</strong><br>${row['NFT Acumulativo'] || '‚Äî'}</div>
        <div class="section info-block"><strong>üìÑ Beneficios Acumulativos:</strong><br>${row['Beneficios Acumulativos'] || '‚Äî'}</div>
        <div class="section info-block"><strong>üìé Notas:</strong><br>${row['Notas'] || '‚Äî'}</div>
        ${(row['Link X']||row['Link Discord']||row['Link Web']) ? `
          <div class="section info-block"><strong>üåê Enlaces:</strong><br>
            ${row['Link X'] ? `<a href="${row['Link X']}" target="_blank" class="buy-button" style="background:#1A1A1A;">X</a>` : ''}
            ${row['Link Discord'] ? `<a href="${row['Link Discord']}" target="_blank" class="buy-button" style="background:#5865F2;">Discord</a>` : ''}
            ${row['Link Web'] ? `<a href="${row['Link Web']}" target="_blank" class="buy-button" style="background:#4A5568;">Web</a>` : ''}
          </div>` : ''}
      `;
    }

    function render(data) {
      cardGrid.innerHTML = '';
      data.forEach((row, i) => {
        const badge = getTierBadge(row['Tier']);
        const card = document.createElement('div');
        card.className = `card ${badge}`;
        card.dataset.index = i;

        card.innerHTML = `
          ${row['Logo'] ? `<img src="${row['Logo']}" class="logo">` : ''}
          <h3>${row['Proyecto']}</h3>
          <div class="tag ${getEstadoClass(row['Estado Testnet'])}">${row['Estado Testnet']}</div>
          <div class="tier-badge ${badge}">Tier ${row['Tier']}</div>
          <button class="copy-btn">Ver detalles</button>
        `;
        card.querySelector('button').addEventListener('click', e => { e.stopPropagation(); showModal(i); });
        cardGrid.appendChild(card);
      });
    }

    function applyFilters() {
      const nameQ = projectFilter.value.toLowerCase();
      const tQ = tierFilter.value;
      const eQ = estadoFilter.value;
      const filtered = allData.filter(r =>
        r['Proyecto'].toLowerCase().includes(nameQ) &&
        (tQ === '' || r['Tier'] === tQ) &&
        (eQ === '' || r['Estado Testnet'] === eQ)
      );
      render(filtered);
    }

    Papa.parse(SHEET_CSV, {
      download: true,
      header: true,
      complete: results => {
        results.data = results.data.map(r => {
          const c = {};
          for (const k in r) c[k.trim().replace(/\s+/g,' ')] = r[k];
          return c;
        });
        allData = results.data.filter(r => r['Proyecto']);
        console.log('COLUMNAS CSV:', Object.keys(allData[0]));
        console.log('PRIMER ROW:', allData[0]);
        render(allData);
        fechaSpan.textContent = new Date().toLocaleDateString('es-AR');
      }
    });

    projectFilter.addEventListener('input', applyFilters);
    tierFilter.addEventListener('change', applyFilters);
    estadoFilter.addEventListener('change', applyFilters);
    window.onclick = e => { if (e.target === modal) modal.style.display = 'none'; };
  </script>
</body>
</html>
