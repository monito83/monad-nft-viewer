<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Proyectos NFT - Red Monad</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: purple;
    }
    table {
      width: 90%;
      margin: auto;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      max-width: 250px;
      word-wrap: break-word;
    }
    th {
      background-color: #f2f2f2;
    }
    select {
      margin: 10px;
      padding: 5px;
    }
    .oculto {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Proyectos NFT - Red Monad</h1>
  <select id="tierFilter">
    <option value="Todos">Todos los Tiers</option>
  </select>
  <select id="proyectoFilter">
    <option value="Todos">Todos los Proyectos</option>
  </select>
  <div id="contenedor"></div>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQqZn_SI4cQDoTc_7HogHjAzEkuLzG_1vlAwPAqHRQ3FuGpddU0vP5Qkx1mu1--LUvdqt2Kce5KRcTK/pub?output=csv";

    fetch(sheetURL)
      .then(response => response.text())
      .then(csv => {
        const rows = csv.trim().split("\n").map(r => r.split(","));
        const headers = rows[0];
        const data = rows.slice(1);

        // Eliminar columnas vacías (después de 'Notas')
        const colLimit = headers.findIndex(h => h.trim().toLowerCase() === "notas") + 1;
        const cleanHeaders = headers.slice(0, colLimit);
        const cleanData = data.map(r => r.slice(0, colLimit));

        renderTable(cleanHeaders, cleanData);
        setupFilters(cleanData);
      });

    function renderTable(headers, data) {
      const contenedor = document.getElementById("contenedor");
      let html = "<table><thead><tr>";
      headers.forEach(h => html += `<th>${h}</th>`);
      html += "</tr></thead><tbody>";
      data.forEach(row => {
        html += "<tr>";
        row.forEach(cell => html += `<td>${cell}</td>`);
        html += "</tr>";
      });
      html += "</tbody></table>";
      contenedor.innerHTML = html;
    }

    function setupFilters(data) {
      const tierSet = new Set();
      const proyectoSet = new Set();
      data.forEach(row => {
        if (row[0]) proyectoSet.add(row[0]); // Nombre del proyecto
        if (row[1]) tierSet.add(row[1]);     // Tier
      });

      const tierSelect = document.getElementById("tierFilter");
      [...tierSet].sort().forEach(t => {
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        tierSelect.appendChild(opt);
      });

      const proyectoSelect = document.getElementById("proyectoFilter");
      [...proyectoSet].sort().forEach(p => {
        const opt = document.createElement("option");
        opt.value = p;
        opt.textContent = p;
        proyectoSelect.appendChild(opt);
      });

      tierSelect.addEventListener("change", applyFilters);
      proyectoSelect.addEventListener("change", applyFilters);
    }

    function applyFilters() {
      const tierValue = document.getElementById("tierFilter").value;
      const proyectoValue = document.getElementById("proyectoFilter").value;

      const rows = document.querySelectorAll("tbody tr");
      rows.forEach(row => {
        const [proyecto, tier] = [row.cells[0].textContent, row.cells[1].textContent];
        const tierMatch = (tierValue === "Todos" || tier === tierValue);
        const proyectoMatch = (proyectoValue === "Todos" || proyecto === proyectoValue);
        row.style.display = (tierMatch && proyectoMatch) ? "" : "none";
      });
    }
  </script>
</body>
</html>
